import type { Meta } from "@storybook/react"
import { Circuit } from "@tscircuit/core"
import type { PcbTraceError } from "circuit-json"
import type React from "react"
import { PCBViewer } from "../PCBViewer"

export const TraceErrorCircuit1: React.FC = () => {
  const circuit = new Circuit()

  circuit.add(
    <board width="10mm" height="10mm">
      <resistor
        name="R1"
        resistance="10k"
        pcbX={-2}
        pcbY={1}
        footprint="0402"
      />
      <resistor
        name="R2"
        resistance="10k"
        pcbX={2}
        pcbY={0}
        footprint="0402"
        layer="bottom"
      />
      <trace path={[".R1 > .right", ".R2 > .left"]} />
    </board>,
  )

  const soup = circuit.getCircuitJson()

  return (
    <div style={{ backgroundColor: "black" }}>
      <PCBViewer circuitJson={soup as any} />
    </div>
  )
}

export const TraceErrorCircuit2: React.FC = () => {
  const circuit = new Circuit()

  circuit.add(
    <board width="10mm" height="10mm">
      <resistor
        name="R1"
        resistance="10k"
        pcbX={-2}
        pcbY={1}
        footprint="0402"
      />
      <resistor name="R2" resistance="10k" layer="bottom" />
      <trace path={[".R1 > .right", ".R2 > .left"]} />
    </board>,
  )

  const soup = circuit.getCircuitJson()

  return (
    <div style={{ backgroundColor: "black" }}>
      <PCBViewer circuitJson={soup as any} />
    </div>
  )
}

// TODO: Fix failing because of `Component` is missing in Core
// export const TraceErrorCircuit3: React.FC = () => {
//   const circuit = new Circuit();

//   circuit.add(
//     <board width="20mm" height="20mm">
//       <group>
//         <footprint>
//           <platedhole
//             pcbX={0}
//             pcbY={-4}
//             portHints={[`1`]}
//             holeDiameter={0.8}
//             outerDiameter={2}
//             shape="circle"
//             name="B1"
//           />
//           <platedhole
//             pcbX={0}
//             pcbY={4}
//             // portHints={[`2`]}
//             holeDiameter={0.8}
//             outerDiameter={2}
//             shape="circle"
//           />
//         </footprint>
//         {/* <port pcbX={0} pcbY={-0.7} name="plus" pinNumber={1} direction="up" />
//         <port pcbX={0} pcbY={0.7} name="minus" pinNumber={2} direction="down" /> */}

//         <resistor
//           name="R1"
//           pcbX={8}
//           pcbY={0}
//           resistance={"10k"}
//           footprint={"0805"}
//         />
//         {/* <trace to=".B1 > .plus" from=".R1 > .left" /> */}
//       </group>
//     </board>
//   );

//   const soup = circuit.getCircuitJson();

//   return (
//     <div style={{ backgroundColor: "black" }}>
//       <PCBViewer circuitJson={soup as any} />
//     </div>
//   );
// };

// Trace error with custom location, manually create soup for this one
export const TraceErrorCircuit4 = () => (
  <div style={{ backgroundColor: "black" }}>
    <PCBViewer
      circuitJson={[
        {
          type: "source_component",
          source_component_id: "generic_0",
          name: "R1",
          supplier_part_numbers: {},
        },
        {
          type: "schematic_component",
          schematic_component_id: "schematic_generic_component_0",
          source_component_id: "generic_0",
          center: { x: 0, y: 0 },
          rotation: 0,
          size: { width: 0, height: 0 },
        },
        {
          type: "pcb_component",
          source_component_id: "generic_0",
          pcb_component_id: "pcb_generic_component_0",
          layer: "top",
          center: { x: 0, y: 0 },
          rotation: 0,
          width: 0,
          height: 0,
        },
        {
          type: "pcb_smtpad",
          layer: "top",
          pcb_component_id: "pcb_generic_component_0",
          pcb_smtpad_id: "pcb_smtpad_0",
          shape: "rect",
          x: 0,
          y: 0,
          width: 1,
          height: 1,
        },
        {
          type: "pcb_smtpad",
          layer: "top",
          pcb_component_id: "pcb_generic_component_0",
          pcb_smtpad_id: "pcb_smtpad_1",
          shape: "rect",
          x: 4,
          y: 4,
          width: 1,
          height: 1,
        },
        {
          type: "pcb_port",
          pcb_port_id: "pcb_port_0",
          source_port_id: "source_port_0",
          x: 0,
          y: 0,
        },
        {
          type: "pcb_port",
          pcb_port_id: "pcb_port_1",
          source_port_id: "source_port_1",
          x: 4,
          y: 4,
        },
        {
          type: "pcb_trace",
          route: [
            { x: 0, y: 0, start_pcb_port_id: "pcb_port_0" },
            { x: 4, y: 4, end_pcb_port_id: "pcb_port_1" },
          ],
        },
        {
          type: "pcb_trace_error",
          message: "Trace error",
          center: { x: 3, y: 1 },
          pcb_port_ids: ["pcb_port_0", "pcb_port_1"],
          error_type: "pcb_trace_error",
          pcb_component_ids: ["pcb_generic_component_0"],
          pcb_trace_error_id: "pcb_error_0", // Changed from pcb_error_id to pcb_trace_error_id
          pcb_trace_id: "pcb_trace_0",
          source_trace_id: "source_trace_0",
        } as PcbTraceError,
      ]}
    />
  </div>
)

const meta: Meta<typeof TraceErrorCircuit1> = {
  title: "TraceError",
  component: TraceErrorCircuit1,
}

export default meta
